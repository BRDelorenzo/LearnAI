<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LearnAI - TranscriÃ§Ã£o de Ãudio</title>
</head>
<body>
  <h1>ğŸ™ï¸ LearnAI - TranscriÃ§Ã£o de Ãudio</h1>
  <button id="startBtn">Iniciar GravaÃ§Ã£o</button>
  <button id="stopBtn" disabled>Parar GravaÃ§Ã£o</button>
  <p id="status">Aguardando gravaÃ§Ã£o...</p>
  <pre id="transcricao"></pre>

  <script>
    let mediaRecorder;
    let audioChunks = [];

    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const status = document.getElementById('status');
    const transcricao = document.getElementById('transcricao');

    startBtn.addEventListener('click', async () => {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);

        audioChunks = [];
        mediaRecorder.start();

        status.textContent = "ğŸ¤ Gravando...";
        startBtn.disabled = true;
        stopBtn.disabled = false;

        mediaRecorder.addEventListener("dataavailable", event => {
          audioChunks.push(event.data);
        });

        mediaRecorder.addEventListener("stop", async () => {
          const audioBlob = new Blob(audioChunks, { type: "audio/webm" });
          const formData = new FormData();
          formData.append("file", audioBlob, "gravacao.webm");

          status.textContent = "â³ Enviando Ã¡udio para o servidor...";

          try {
            const response = await fetch("http://localhost:3000/transcrever", {
              method: "POST",
              body: formData
            });

            if (!response.ok) {
              throw new Error(`Erro do servidor: ${response.status}`);
            }

            const data = await response.json();
            transcricao.textContent = data.transcricao || "Nenhuma transcriÃ§Ã£o retornada.";
            status.textContent = "âœ… TranscriÃ§Ã£o concluÃ­da!";
          } catch (err) {
            console.error(err);
            status.textContent = `âŒ Erro: ${err.message}`;
          }

          startBtn.disabled = false;
          stopBtn.disabled = true;
        });
      } catch (err) {
        console.error(err);
        status.textContent = "âŒ Erro ao acessar o microfone.";
      }
    });

    stopBtn.addEventListener('click', () => {
      if (mediaRecorder && mediaRecorder.state === "recording") {
        mediaRecorder.stop();
        status.textContent = "ğŸ›‘ GravaÃ§Ã£o parada.";
      }
    });
  </script>
</body>
</html>
